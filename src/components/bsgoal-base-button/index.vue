<!--
 * @Author: canlong.shen
 * @Date: 2023-05-18 16:24:25
 * @LastEditors: canlong.shen
 * @LastEditTime: 2023-08-31 16:11:23
 * @FilePath: \v3_basic_component\src\components\bsgoal-base-button\index.vue
 * @Description: 统一按钮 
 * 
-->

<script setup>
/* setup模板
---------------------------------------------------------------- */
import { ref, unref, computed } from 'vue'
import { Delete, Plus, CloseBold, Select } from '@element-plus/icons-vue'

defineOptions({
  name: 'BsgoalBaseButton'
})

const props = defineProps({
  task: {
    type: [Object, Function],
    default: () => {
      Promise.resolve()
    }
  },
  type: {
    type: [String],
    default: '',
    validator: (v) => ['primary', 'success', 'warning', 'danger', 'info'].includes(v)
  },
  icon: {
    type: [String, Object, Boolean],
    default: ''
  },
  content: {
    type: [String],
    default: ''
  },
  mode: {
    type: [String],
    default: 'default',
    validator: (v) => ['add', 'delete', 'edit', 'detail', 'default', 'cancel'].includes(v)
  },
  values: {
    type: [Array, Object],
    default: () => ({})
  },
  plain: {
    type: [Boolean],
    default: false
  },
  /**
   * 是否有 loading
   */
  hasLoading: {
    type: [Boolean],
    default: true
  },
  /**
   * disabled
   */
  disabled: {
    type: [Boolean],
    default: false
  },

  /**
   *  确认
   */
  hasConfirm: {
    type: [Boolean],
    default: false
  },
  /**
   * 确认框内容
   */
  title: {
    type: [String],
    default: '是否删除!'
  }
})

// ---> S 触发按钮 <---
const loading = ref(false)
const triggerClick = () => {
  // 默认 loading 是打开的
  if (props.hasLoading) {
    loading.value = true
  }
  const { task } = props
  const taskValue = unref(task)
  taskValue(() => {
    loading.value = false
  }, props.values)
}
// ---> E 触发按钮 <---

// ---> S 模式 <---

const typeGet = computed(() => {
  const { mode = '', type = '' } = props

  switch (mode) {
    case 'delete':
      return 'danger'
    case 'cancel':
      return ''
    case 'confirm':
    case 'add':
    case 'edit':
      return 'primary'
  }
  return type
})
const iconGet = computed(() => {
  const { mode = '', icon = '' } = props
  if (icon !== false) {
    switch (mode) {
      case 'delete':
        return Delete
      case 'add':
        return Plus
      case 'cancel':
        return CloseBold
      case 'confirm':
        return Select
    }
  }

  return icon
})
const contentGet = computed(() => {
  const { mode = '', content = '' } = props

  switch (mode) {
    case 'cancel':
      return '取消'
    case 'confirm':
      return '确认'
    case 'add':
      return '新增'
    case 'edit':
      return '编辑'
    case 'delete':
      return '删除'
    case 'detail':
      return '详情'
  }
  return content
})

// ---> E 模式 <---
</script>
<template>
  <div class="bsgoal-base-button">
    <template v-if="hasConfirm && !disabled">
      <div class="base_button">
        <el-popconfirm :title="title" @confirm="triggerClick">
          <template #reference>
            <slot :loading="loading">
              <el-button
                :type="typeGet"
                :icon="iconGet"
                :loading="loading"
                :plain="plain"
                :disabled="disabled"
                >{{ contentGet }}</el-button
              >
            </slot>
          </template>
        </el-popconfirm>
      </div>
    </template>
    <template v-else>
      <div class="base_button" @click="triggerClick">
        <slot :loading="loading">
          <el-button
            :type="typeGet"
            :icon="iconGet"
            :loading="loading"
            :plain="plain"
            :disabled="disabled"
            >{{ contentGet }}</el-button
          >
        </slot>
      </div>
    </template>
  </div>
</template>
<style lang="scss">
/* 覆盖样式
---------------------------------------------------------------- */
.bsgoal-base-button {
  &,
  .base_button {
    display: inline-block;
  }
}
</style>
